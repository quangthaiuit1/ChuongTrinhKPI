<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/pages/home.xhtml">

	<ui:define name="content">
		<style>
.selectbllb .ui-chkbox-label {
	font-size: 1.2em;
	margin-left: 20px;
	font-weight: bold;
}
</style>
		<h3 style="margin: 0px">KPI cá nhân (Nhóm khác)</h3>
		<p:separator />
		<p:growl id="growl" showDetail="true" sticky="false" />
		<p:tabView id="tv" widgetVar="myTab">
			<p:tab title="Danh Sách">
				<h:form id="list">
					<p:panel
						style="float:right; border:0px; margin-top:-65px !important;background:none;">
						<h:panelGrid id="mainGrid" columns="9"
							style="float:left; margin-bottom:5px">
							<h:panelGrid columns="4" style="width:100%" cellspacing="10">
								<p:outputLabel value="Tháng" />
								<p:spinner size="10" value="#{personalOtherBean.monthSearch}"
									min="1" max="12">
									<p:ajax process="@this"
										listener="#{personalOtherBean.searchItem()}"
										update="tableid_new_2"
										oncomplete="PF('dtlistkpiperson_new').clearFilters()" />
								</p:spinner>
								<p:outputLabel value="Năm" />
								<p:spinner size="10" value="#{personalOtherBean.yearSearch}"
									min="2017" max="2050">
									<p:ajax process="@this"
										listener="#{personalOtherBean.searchItem()}"
										oncomplete="PF('dtlistkpiperson_new').clearFilters()" />
								</p:spinner>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:commandButton type="submit" value="Tạo danh sách"
									process="@this" id="btnew"
									action="#{personalOtherBean.create()}" icon="ui-icon-document"
									oncomplete="PF('dtlistkpiperson_new').clearFilters()" />
							</h:panelGrid>
							<h:panelGrid columns="2" style="width:100%" cellspacing="10">
								<p:selectOneMenu value="#{personalOtherBean.departmentSelected}"
									converter="abstractConverter" effect="fade" var="t"
									style="width:150px;" id="iddeps" filter="true"
									filterMatchMode="custom" filterFunction="customFilter">
									<f:selectItems value="#{personalOtherBean.departmentSearchs}"
										var="item" itemLabel="#{item.name}" itemValue="#{item}" />
									<p:ajax process="@this"
										listener="#{personalOtherBean.searchItem()}"
										oncomplete="PF('dtlistkpiperson_new').clearFilters()" />
									<p:column>
										<h:outputText value="#{t.code}" />
									</p:column>
									<p:column>
										<h:outputText value="#{t.showAllNameDepart()}" escape="false" />
									</p:column>
								</p:selectOneMenu>
							</h:panelGrid>
						</h:panelGrid>
					</p:panel>
					<div style="clear: both" />
					<p:dataTable value="#{personalOtherBean.kpiPersonalOthers}"
						widgetVar="dtlistkpiperson_new" styleClass="tableparent"
						paginator="true" paginatorPosition="bottom" rows="50"
						scrollable="true" scrollHeight="400"
						filteredValue="#{personalOtherBean.kPIPersonFilters}"
						id="tableid_new_2" var="item" rowIndexVar="index">
						<p:column headerText="..." style="width:5%; text-align:center">
							<p:commandButton icon="ui-icon-closethick"
								style="margin-left: -9px;background: none;border: none; box-shadow: none;"
								update="tableid_new_2" styleClass="btnoneformat" process="@this"
								actionListener="#{personalOtherBean.removeKPIPersonOther(item)}" />
						</p:column>
						<p:column headerText="STT" style="width:5%;text-align:center">
							<h:outputText value="#{index + 1}" />
						</p:column>
						<p:column headerText="Duyệt KQ" style="width:10%;text-align:center">
							<p:selectBooleanCheckbox value="#{item.signResult}"
								disabled="true" />
						</p:column>
						<p:column headerText="Tháng" style="width:5%; text-align:center">
							<p:tooltip for="mlist" value="ID: #{item.id}" />
							<h:outputText value="#{item.kMonth}" id="mlist" />
						</p:column>
						<p:column headerText="Năm" style="width:10%;text-align:center">
							<h:outputText value="#{item.kYear}" />
						</p:column>
						<p:column headerText="Tổng điểm"
							style="width:10%;text-align:center">
							<h:outputText value="#{item.total/100}">
								<f:convertNumber pattern="##0%" />
							</h:outputText>
						</p:column>
						<p:column headerText="Nhân viên" style="width:45%;text-align:center"
							filterBy="#{item.nameEmp}"
							filterFunction="#{abstractCustomFilter.filterByText}">
							<h:outputText value="#{item.nameEmp}" />
						</p:column>
						<p:column headerText="Chi tiết"
							style="width:10%;text-align:center">
							<p:commandLink type="submit" value="Đánh giá"
								actionListener="#{personalOtherBean.showDialogOrien(item)}"
								update=":dialogKPIPersonalOther,:messages,tv:list:tableid_new_2,idKPIPersonalOtherBehaviour"
								process="@this" icon="ui-icon-plus"
								style="font-style:italic;font-weight:bold" />
						</p:column>
						<f:facet name="footer">
							<div style="clear: both;" />
						</f:facet>
					</p:dataTable>
				</h:form>
			</p:tab>
		</p:tabView>

		<p:dialog widgetVar="widgetKPIPersonalOther" resizable="false"
			width="700" height="500" closeOnEscape="true"
			id="idKPIPersonalOtherBehaviour" header="" modal="true">
			<f:facet name="header">
				<h:outputText value="Bảng chi tiết vi phạm:"
					style="margin-right:50px" />
				<h:outputText value="#{personalOtherBean.personSelected.nameEmp}"
					style="font-size:20px" />
			</f:facet>
			<h:form id="dialogKPIPersonalOther">
				<p:fieldset legend="Danh sách" toggleable="true" toggleSpeed="500"
					collapsed="false"
					style="border: 0px;border-top: 1px solid #b8bbbb; border-radius: 0px;margin-top:10px"
					styleClass="toggleabldetail">
					<p:dataTable var="item" styleClass="tableformat1" id="tableidHV"
						scrollable="true" value="#{personalOtherBean.personDetails}"
						scrollWidth="100%">
						<f:facet name="header">
							<p:commandButton action="#{personalOtherBean.showBehaviour()}"
								oncomplete="PF('dialogBeh').show();" process="@this"
								value="Thêm thái độ hành vi" style="float:left"
								update=":dialogBehid" icon="ui-icon-plus" />
							<p:commandButton
								action="#{personalOtherBean.showVitriChucVuCongViec()}"
								process="@this" value="Vị trí/chức vụ công việc"
								style="float:left" update="formViTriChucVu" icon="ui-icon-plus" />
							<p:commandButton value="Lưu/cập nhật"
								action="#{personalOtherBean.saveBehaviourDetail()}"
								style="float:right" update="growl, tv:list:tableid_new_2"
								oncomplete="PF('dtlistkpiperson_new').clearFilters()" />
							<div style="clear: both;" />
						</f:facet>
						<p:column headerText="..." style="width:6px; text-align:center">
							<p:commandButton icon="ui-icon-closethick"
								style="margin-left: -9px;background: none;border: none; box-shadow: none;"
								update="tableidHV" styleClass="btnoneformat" process="@this"
								actionListener="#{personalOtherBean.removePersonDetail(item)}" />
						</p:column>
						<p:column headerText="Tiêu chí/ Mục tiêu đánh giá" width="170">
							<p:outputLabel value="#{item.content}" rows="2"
								autoResize="false" />
						</p:column>
						<p:column headerText="Điểm trừ (%)" width="60"
							style="text-align:center">
							<h:outputText value="#{item.minuspoint/100}" rows="2"
								style="text-align:center">
								<f:convertNumber pattern="##0%" />
							</h:outputText>
						</p:column>
						<p:column headerText="Số lượng" width="40">
							<p:spinner size="10" value="#{item.quantity}" min="1" max="10" />
						</p:column>
					</p:dataTable>
				</p:fieldset>
				<!-- o day ne -->
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="widgetKPIPersonalOtherBehaviour"
			resizable="false" width="700" closeOnEscape="true"
			header="Chi tiết thái độ/hành vi">
			<h:form id="formDialogKPIPersonalOtherBehaviour">
				<p:dataTable var="item" styleClass="tableformat1" id="tableidHV"
					paginator="true" rows="40" rowKey="#{item.id}" scrollable="true"
					rowsPerPageTemplate="20,40,60" sortBy="#{item.id}"
					expandableRowGroups="true" style="width:100%"
					paginatorPosition="bottom" scrollHeight="370"
					value="#{personalOtherBean.details}" rowIndexVar="rowIndex">

					<p:column headerText="..." style="width:6px; text-align:center">
						<p:commandButton icon="ui-icon-closethick"
							style="margin-left: -9px;background: none;border: none; box-shadow: none;"
							update="tv:list:tableid_new_2,tableidHV"
							styleClass="btnoneformat" process="@this"
							actionListener="#{personalOtherBean.removeDetail(item)}" />
					</p:column>
					<p:column headerText="STT" width="5" style="text-align:center">
						<p:outputLabel value="#{rowIndex+1}" rows="2"
							style="text-align:center" />
					</p:column>
					<p:column headerText="Tiêu chí/ Mục tiêu đánh giá" width="170">
						<p:outputLabel value="#{item.content}" rows="2" autoResize="false" />
					</p:column>
					<p:column headerText="Điểm trừ (%)" width="60"
						style="text-align:center">
						<h:outputText value="#{item.minuspoint/100}" rows="2"
							style="text-align:center">
							<f:convertNumber pattern="##0%" />
						</h:outputText>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

		<p:dialog widgetVar="dialogBeh" resizable="false" width="700"
			closeOnEscape="true" header="Danh mục thái độ - hành vi" modal="true">
			<h:form id="dialogBehid">
				<p:dataTable value="#{personalOtherBean.behaviourOthers}"
					lazy="true" paginatorPosition="bottom"
					rowsPerPageTemplate="20,40,60" paginator="true" rows="40"
					rowKey="#{item.id}" scrollable="true" style="width:100%"
					id="tablebehid" scrollHeight="470" widgetVar="databehtb"
					resizableColumns="true" var="item">
					<f:facet name="header">
						<div style="float: right">
							<p:commandButton type="submit" value="Thêm"
								update="dialogKPIPersonalOther:tableidHV"
								action="#{personalOtherBean.addBehaviourDetail()}"
								icon="ui-icon-arrowreturnthick-1-s"
								oncomplete="PF('dialogBeh').hide();" />
						</div>
						<div style="clear: both;" />
					</f:facet>
					<p:column headerText="..." style="width:20px;">
						<p:selectBooleanCheckbox value="#{item.select}"
							rendered="#{!item.header}">
							<p:ajax process="@this" />
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column headerText="STT" style="width:20px">
						<h:outputText value="#{item.code}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Nội dung" style="text-align:left">
						<h:outputText value="#{item.content}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Điểm trừ" width="80"
						style="text-align:center">
						<h:outputText value="#{item.header!=true?item.minusPoint/100:''}">
							<f:convertNumber pattern="##0%" />
						</h:outputText>
					</p:column>
					<f:facet name="footer">
						<div style="clear: both;" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="wgvTableViTriChucVu" resizable="false"
			width="700" closeOnEscape="true" header="Vị trí chức vụ công việc"
			modal="true">
			<h:form id="formViTriChucVu">
				<p:dataTable
					value="#{personalOtherBean.listInfoPersonalPerformances}"
					id="tbreportimptargetsale" expandableRowGroups="true"
					paginatorPosition="bottom" paginator="true" scrollable="true"
					scrollHeight="500" resizableColumns="true" var="itemp"
					expandedRow="#{true}">
					<f:facet name="header">
						<div style="float: right">
							<p:commandButton type="submit" value="Thêm"
								action="#{personalOtherBean.addViTriChucVu()}"
								update="dialogKPIPersonalOther:tableidHV"
								icon="ui-icon-arrowreturnthick-1-s"
								oncomplete="PF('wgvTableViTriChucVu').hide();" />
						</div>
						<div style="clear: both;" />
					</f:facet>
					<p:column style="width:30px">
						<p:rowToggler />
					</p:column>
					<p:column headerText="Vị trí/chức vụ công việc">
						<h:outputText value="#{itemp.positionJobName}" />
					</p:column>
					<p:rowExpansion>
						<p:dataTable value="#{itemp.personalPerformances}" lazy="true"
							sortBy="#{item.id}" expandableRowGroups="true"
							paginatorPosition="bottom" rowsPerPageTemplate="20,40,60"
							paginator="true" rows="40" rowKey="#{item.id}" scrollable="true"
							style="width:100%" id="dtTableAddKPIPerformancePersonal"
							scrollHeight="370" widgetVar="dtTableAddKPIPerformancePersonal"
							resizableColumns="true" var="item" rowIndexVar="rowIndex">

							<p:column headerText="..." style="width:20px;">
								<p:selectBooleanCheckbox value="#{item.select}">
									<p:ajax process="@this" />
								</p:selectBooleanCheckbox>
							</p:column>
							<p:column headerText="STT" style="width:20px;">
								<h:outputText value="#{rowIndex+1}" />
							</p:column>
							<p:column headerText="Nội dung"
								style="text-align:left;width: 200px">
								<h:outputText value="#{item.content}" />
							</p:column>
							<p:column headerText="Điểm trừ"
								style="text-align:left;width:40px">
								<h:outputText value="#{item.minuspoint/100}">
									<f:convertNumber pattern="##0%" />
								</h:outputText>
							</p:column>
							<f:facet name="footer">
								<div style="clear: both;" />
							</f:facet>
						</p:dataTable>
					</p:rowExpansion>
				</p:dataTable>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>