<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/pages/home.xhtml">

	<ui:define name="content">
		<style>
.selectbllb .ui-chkbox-label {
	font-size: 1.2em;
	margin-left: 20px;
	font-weight: bold;
}
</style>
		<h3 style="margin: 0px">Duyệt KPI cá nhân</h3>
		<p:separator />
		<h:form id="formdataassign">
			<p:commandButton ajax="false" value="xem" style="display:none"
				onclick="this.form.target='_blank'" id="process"
				action="#{kPIPersonAssignBean.showPDFData()}" />
			<p:commandButton ajax="false" value="xem" style="display:none"
				onclick="this.form.target='_blank'" id="report"
				action="#{kPIPersonAssignBean.printList()}" />
		</h:form>
		<h:form id="menuformid">
			<p:tabView id="tv" widgetVar="myTab"
				activeIndex="#{kPIPersonAssignBean.tabindex}">
				<p:ajax event="tabChange" />
				<p:tab title="Danh Sách">
					<h:form id="list">
						<p:panel
							style="float:right; border:0px; margin-top:-65px !important; background:none;">
							<h:panelGrid id="mainGrid" columns="6"
								style="float:left; margin-bottom:5px">
								<h:panelGrid columns="4" style="width:100%" cellspacing="10">
									<p:outputLabel value="Tháng" />
									<p:spinner size="10" value="#{kPIPersonAssignBean.monthSearch}"
										min="1" max="12">
										<p:ajax process="@this" />
									</p:spinner>
									<p:outputLabel value="Năm" />
									<p:spinner size="10" value="#{kPIPersonAssignBean.yearSearch}"
										min="2017" max="2050">
										<p:ajax process="@this" />
									</p:spinner>
								</h:panelGrid>
								<h:panelGrid columns="2" style="width:100%" cellspacing="10">
									<p:selectOneMenu
										value="#{kPIPersonAssignBean.departmentSearch}"
										converter="abstractConverter" effect="fade" var="t"
										style="width:150px;" id="iddeps" filter="true"
										filterMatchMode="custom" filterFunction="customFilter">
										<f:selectItems
											value="#{kPIPersonAssignBean.departmentSearchs}" var="item"
											itemLabel="#{item.name}" itemValue="#{item}" />
										<p:column>
											<h:outputText value="#{t.code}" />
										</p:column>
										<p:column>
											<h:outputText value="#{t.showAllNameDepart()}" escape="false" />
										</p:column>
									</p:selectOneMenu>
								</h:panelGrid>
								<p:commandButton value="Tìm" style="float:right;"
									oncomplete="PF('dtlistkpiperson').clearFilters()"
									icon="ui-icon-search" update="tableid" process="@form"
									actionListener="#{kPIPersonAssignBean.searchItem()}" />
								<p:tooltip for="xoact" value="Xoá KPI cá nhân" />
								<p:commandButton value="Xóa" id="xoact" process="@this"
									update=":messages,:menuformid"
									action="#{kPIPersonAssignBean.delete()}">
									<p:confirm header="Xác nhận"
										message="Bạn có chắc muốn xoá không?" icon="ui-icon-alert" />
								</p:commandButton>

							</h:panelGrid>
						</p:panel>
						<div style="clear: both" />
						<p:selectBooleanCheckbox value="#{kPIPersonAssignBean.select}"
							itemLabel="Chọn hết(chọn để in danh sách)"
							style="margin:0px 10px 3px 10px">
							<p:ajax process="@this"
								listener="#{kPIPersonAssignBean.eventSelect}" update="tableid" />
						</p:selectBooleanCheckbox>
						<p:commandButton id="remote" icon="ui-icon-print"
							style="margin-bottom:3px;" value="In danh sách KPI"
							styleClass="bthei40" process="@form"
							actionListener="#{kPIPersonAssignBean.processList()}" />
						<p:dataTable value="#{kPIPersonAssignBean.kPIPersons}"
							widgetVar="dtlistkpiperson" styleClass="tableparent"
							rowKey="#{item.id}"
							filteredValue="#{kPIPersonAssignBean.kPIPersonFilters}"
							selection="#{kPIPersonAssignBean.kPIPersonEdit}"
							selectionMode="single" id="tableid" var="item">
							<p:ajax event="rowSelect"
								listener="#{kPIPersonAssignBean.showEdit}"
								update=":menuformid:tv:detail" />
							<p:column headerText="..." style="width:5px;">
								<p:selectBooleanCheckbox value="#{item.select}">
									<p:ajax process="@this" />
								</p:selectBooleanCheckbox>
							</p:column>
							<p:column headerText="Duyệt ĐK"
								style="width:25px;text-align:center">
								<p:selectBooleanCheckbox value="#{item.signKPI}" disabled="true" />
							</p:column>
							<p:column headerText="Duyệt KQ"
								style="width:25px;text-align:center">
								<p:selectBooleanCheckbox value="#{item.signResultKPI}"
									disabled="true" />
							</p:column>
							<p:column headerText="ID" style="width:30px; text-align:center">
								<h:outputText value="#{item.id}" />
							</p:column>
							<p:column headerText="Tháng"
								style="width:30px; text-align:center">
								<p:tooltip for="mlist" value="ID: #{item.id}" />
								<h:outputText value="#{item.kmonth}" id="mlist" />
							</p:column>
							<p:column headerText="Năm" style="width:30px;text-align:center">
								<h:outputText value="#{item.kyear}" />
							</p:column>
							<p:column headerText="Tổng điểm"
								style="width:30px;text-align:center">
								<h:outputText value="#{item.total/100}">
									<f:convertNumber pattern="##0%" />
								</h:outputText>
							</p:column>
							<p:column headerText="Mã NV" style="width:50px"
								filterBy="#{item.codeEmp}"
								filterFunction="#{abstractCustomFilter.filterByText}">
								<h:outputText value="#{item.codeEmp}" />
							</p:column>
							<p:column headerText="Nhân viên" style="width:100px"
								filterBy="#{item.nameEmp}"
								filterFunction="#{abstractCustomFilter.filterByText}">
								<h:outputText value="#{item.nameEmp}" />
							</p:column>
							<p:column headerText="Phòng ban" style="width:100px"
								filterBy="#{item.nameDepart}"
								filterFunction="#{abstractCustomFilter.filterByText}">
								<h:outputText value="#{item.nameDepart}" />
							</p:column>
							<f:facet name="footer">
								<div style="clear: both;" />
							</f:facet>
						</p:dataTable>
					</h:form>
				</p:tab>
				<p:tab title="Chi tiết">
					<h:form id="detail">
						<p:panel
							style="float:right; border:0px; margin-top:-53px !important">
							<p:selectBooleanCheckbox itemLabel="Duyệt đăng ký KPI"
								disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
								styleClass="selectbllb"
								value="#{kPIPersonAssignBean.kPIPerson.signKPI}">
								<p:ajax process="@this"
									listener="#{kPIPersonAssignBean.updatesignKPI()}"
									update=":menuformid,:menuformid:tv:list:tableid,:messages" />
							</p:selectBooleanCheckbox>
							<p:selectBooleanCheckbox itemLabel="Duyệt kết quả KPI"
								disabled="#{!kPIPersonAssignBean.kPIPerson.signKPI}"
								styleClass="selectbllb"
								value="#{kPIPersonAssignBean.kPIPerson.signResultKPI}">
								<p:ajax process="@this"
									listener="#{kPIPersonAssignBean.updatesignResultKPI()}"
									update=":menuformid,:messages" />
							</p:selectBooleanCheckbox>
						</p:panel>
						<p:fieldset>
							<p:fieldset legend="Thời gian*" styleClass="noneformatfs"
								style="width:20%;float:left; height:60px">
								<h:panelGrid columns="2" styleClass="noneformat" cellspacing="5"
									columnClasses="w30,w30">
									<h:panelGrid columns="2" styleClass="noneformat"
										columnClasses="w20,w80">
										<p:outputLabel value="Tháng" />
										<p:spinner min="1" max="12" size="4" disabled="true"
											value="#{kPIPersonAssignBean.kPIPerson.kmonth}" />
									</h:panelGrid>
									<h:panelGrid columns="2" styleClass="noneformat"
										columnClasses="w20,w80">
										<p:outputLabel value="Năm" />
										<p:spinner size="5" min="2017" max="2050" disabled="true"
											value="#{kPIPersonAssignBean.kPIPerson.kyear}" />
									</h:panelGrid>
								</h:panelGrid>
							</p:fieldset>
							<p:fieldset legend="Đơn vị/Phòng ban - Nhân viên*"
								style="width:28%;float:left; height:60px"
								styleClass="noneformatfs">
								<p:panelGrid columns="2" columnClasses="w95, w5" id="ifjobdep"
									style="width:100%">
									<h:panelGrid columns="1">
										<h:outputText
											value="#{kPIPersonAssignBean.member.department.name}" />
										<h:outputText value="#{kPIPersonAssignBean.member.name}" />
									</h:panelGrid>
									<p:commandLink>
										<h:outputText class="fa fa-fw fa-edit" />
									</p:commandLink>
								</p:panelGrid>
							</p:fieldset>
							<p:fieldset legend="Ngày duyệt tiêu chí"
								styleClass="noneformatfs"
								style="width:12%;float:left; height:60px">
								<p:calendar styleClass="subw40" locale="vi"
									disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
									value="#{kPIPersonAssignBean.kPIPerson.dateRecei}"
									pattern="#{applicationBean.cf.formatDate}"
									showButtonPanel="true" navigator="true" showOn="button"
									mask="#{applicationBean.cf.maskDate}" />
							</p:fieldset>
							<p:fieldset legend="Ngày duyệt kết quả" styleClass="noneformatfs"
								style="width:12%;float:left; height:60px">
								<p:calendar styleClass="subw40" locale="vi"
									value="#{kPIPersonAssignBean.kPIPerson.dateAssignResult}"
									disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
									pattern="#{applicationBean.cf.formatDate}"
									showButtonPanel="true" navigator="true" showOn="button"
									mask="#{applicationBean.cf.maskDate}" />
							</p:fieldset>
							<p:fieldset legend="Tổng điểm" styleClass="noneformatfs"
								style="width:20%;float:left; height:60px">
								<h:outputText value="#{kPIPersonAssignBean.kPIPerson.total/100}"
									style="color: #b12fc0; font-size: 2.5em; font-weight: bold;text-align:center;">
									<f:convertNumber pattern="##0%" />
								</h:outputText>
							</p:fieldset>
							<p:fieldset legend="Ghi chú" styleClass="noneformatfs"
								style="width:49%;float:left; height:55px">
								<p:inputTextarea cols="20" rows="2"
									disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
									value="#{kPIPersonAssignBean.kPIPerson.note}" />
							</p:fieldset>
							<p:fieldset
								style="background:cadetblue; width:47%;float:left; height:45px;margin-top:10px"
								styleClass="noneformatfs">
								<div style="float: right; margin-top: 10px">
									<p:commandButton type="submit" value="Tính kết quả"
										process="@form" style="background:#fbe4c6"
										actionListener="#{kPIPersonAssignBean.caculatorResult()}"
										update=":menuformid:tv:detail" icon="ui-icon-calculator" />
									<p:commandButton type="submit" value="Lưu/cập nhật"
										process="@form"
										action="#{kPIPersonAssignBean.createOrUpdate()}"
										update=":messages" icon="ui-icon-disk" />
								</div>
							</p:fieldset>
						</p:fieldset>
						<p:fieldset style="    padding-top: 20px;">
							<p:panel id="totalhvid"
								style="float:right; border:0px; margin-top:-20px !important;margin-bottom:-30px !important; background:none">
								<h:outputText value="Tổng điểm: " />
								<h:outputText value="10%"
									style="margin:0px 50px 0px 10px; color: red; font-size: 1.2em; font-weight: bold;">
								</h:outputText>
								<h:outputText value="Điểm đạt được: " />
								<h:outputText
									value="#{kPIPersonAssignBean.kPIPerson.totalHV/100}"
									style="margin:0px 0px 0px 10px; color: red; font-size: 1.2em; font-weight: bold; ">
									<f:convertNumber pattern="##0%" />
								</h:outputText>

							</p:panel>
							<p:fieldset legend="Thái độ hành vi" toggleable="true"
								toggleSpeed="500" collapsed="true"
								style="border: 0px;border-top: 1px solid #b8bbbb; border-radius: 0px;"
								styleClass="toggleabldetail">
								<p:dataTable var="item" styleClass="tableformat1" id="tableidHV"
									scrollable="true"
									value="#{kPIPersonAssignBean.kpiPersonOfMonthAdds}"
									scrollWidth="1085">
									<f:facet name="header">
										<p:commandButton
											action="#{kPIPersonAssignBean.showBehaviour()}"
											rendered="#{!kPIPersonAssignBean.kPIPerson.signResultKPI}"
											oncomplete="PF('dialogBeh').show();" process="@this"
											value="Thêm thái độ hành vi" style="float:left"
											update=":dialogBehid" icon="ui-icon-plus" />
										<div style="clear: both;" />
									</f:facet>
									<p:column headerText="..." style="width:6px; text-align:center">
										<p:commandButton icon="ui-icon-closethick"
											rendered="#{!kPIPersonAssignBean.kPIPerson.signResultKPI}"
											style="margin-left: -9px;background: none;border: none; box-shadow: none;"
											update="tableidHV" styleClass="btnoneformat" process="@this"
											actionListener="#{kPIPersonAssignBean.removeDetailAdd(item.no)}" />
									</p:column>
									<p:column headerText="STT" width="5">
										<p:outputLabel value="#{item.no}" rows="2"
											style="text-align:center" />
									</p:column>
									<p:column headerText="Tiêu chí/ Mục tiêu đánh giá" width="170">
										<p:outputLabel value="#{item.contentAppreciate}" rows="2"
											autoResize="false" />
									</p:column>
									<p:column headerText="Điểm trừ (%)" width="60"
										style="text-align:center">
										<h:outputText value="#{item.ratioComplete/100}" rows="2"
											style="text-align:center">
											<f:convertNumber pattern="##0%" />
										</h:outputText>
									</p:column>
									<p:column headerText="Điểm trừ nhân trọng số (%)" width="60"
										style="text-align:center">
										<h:outputText value="#{item.ratioCompleteIsWeighted/100}"
											rows="2" style="text-align:center">
											<f:convertNumber pattern="##0%" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</p:fieldset>
							<br />
							<p:panel id="totalcvid"
								style="float:right; border:0px; margin-top:-20px !important;margin-bottom:-30px !important; background:none;">
								<h:outputText value="Tổng điểm: " />
								<h:outputText value="90%"
									style="margin:0px 50px 0px 10px; color: red; font-size: 1.2em; font-weight: bold;">
								</h:outputText>
								<h:outputText value="Điểm đạt được: " />
								<h:outputText
									value="#{kPIPersonAssignBean.kPIPerson.totalCV/100}"
									style="margin:0px 0px 0px 10px; color: red; font-size: 1.2em; font-weight: bold;">
									<f:convertNumber pattern="##0%" />
								</h:outputText>
							</p:panel>
							<p:fieldset legend="Giải quyết công việc" toggleable="true"
								toggleSpeed="500" collapsed="false"
								style="border: 0px;border-top: 1px solid #b8bbbb; border-radius: 0px;"
								styleClass="toggleabldetail">
								<p:dataTable var="item" styleClass="tableformat1"
									scrollable="true" editable="true" editMode="cell"
									value="#{kPIPersonAssignBean.kpiPersonOfMonths}"
									resizableColumns="true" scrollWidth="1085" id="idtableinput">
									<f:facet name="header">
										<div style="float: left">
											<p:commandButton action="#{kPIPersonAssignBean.addDetail()}"
												process="@this" value="Thêm ngoài định hướng"
												rendered="#{!kPIPersonAssignBean.kPIPerson.signKPI}"
												style="float:left" update="idtableinput" icon="ui-icon-plus" />
											<p:commandButton type="submit" value="Định hướng"
												actionListener="#{kPIPersonAssignBean.showDialogOrien()}"
												rendered="#{!kPIPersonAssignBean.kPIPerson.signKPI}"
												update=":dialogOrienid,:messages" process="@this"
												icon="ui-icon-arrowthick-1-ne" />
											<p:commandButton type="submit" value="KPI phòng"
												rendered="#{!kPIPersonAssignBean.kPIPerson.signKPI}"
												actionListener="#{kPIPersonAssignBean.showDialogKPIDepart()}"
												update=":dialogKPIDepartid,:messages" process="@this"
												icon="ui-icon-arrowthick-1-ne" />
										</div>
										<div style="float: right">
											<p:commandButton id="toggler" type="button" value="Cột"
												icon="ui-icon-calculator" />
											<p:columnToggler datasource="idtableinput" trigger="toggler">
												<p:ajax event="toggle"
													listener="#{kPIPersonAssignBean.onToggle}" />
											</p:columnToggler>
										</div>
										<div style="clear: both;" />
									</f:facet>
									<p:column headerText="..." style="width:6px; text-align:center"
										visible="#{kPIPersonAssignBean.list[0]}">
										<p:commandButton id="btxoa" icon="ui-icon-closethick"
											style="margin-left: -9px;background: none;border: none; box-shadow: none;"
											update="idtableinput" styleClass="btnoneformat"
											rendered="#{!kPIPersonAssignBean.kPIPerson.signKPI}"
											process="@this"
											actionListener="#{kPIPersonAssignBean.removeDetail(item.index)}" />
									</p:column>
									<p:column headerText="STT"
										visible="#{kPIPersonAssignBean.list[1]}" width="10">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.no}" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.no}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Tiêu chí/ Mục tiêu đánh giá" width="200"
										visible="#{kPIPersonAssignBean.list[2]}">
										<h:outputText value="#{item.contentAppreciate}" rendered="#{item.KPIPerformance}"/>
										<p:cellEditor rendered="#{item.KPIPerformance == false}">
											<f:facet name="output">
												<h:outputText value="#{item.contentAppreciate}" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.contentAppreciate}" rows="4"
													disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
													autoResize="false">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Trọng số(%)" width="20"
										visible="#{kPIPersonAssignBean.list[3]}">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.weighted/100}">
													<f:convertNumber pattern="##0%" />
												</h:outputText>
											</f:facet>
											<f:facet name="input">
												<p:inputNumber value="#{item.weighted}" symbol="%"
													disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
													decimalPlaces="0" symbolPosition="s">
													<p:ajax process="@this" />
												</p:inputNumber>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="KPI hiệu suất" width="32">
										<center>
											<h:outputText rendered="#{item.KPIPerformance}"
												styleClass="ui-icon ui-icon-check" />
										</center>
									</p:column>
									<p:column headerText="Phương pháp đo" width="100"
										visible="#{kPIPersonAssignBean.list[4]}">
										<p:outputLabel value="#{item.codeFormula}" rows="4"
											autoResize="false" />
										<p:commandLink style="float:right" process="@this"
											rendered="#{item.orientationPerson==null}"
											disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
											actionListener="#{kPIPersonAssignBean.showListFormula(item)}"
											update=":dialogformula">
											<h:outputText value="&#8801;" rendered="#{item.KPIPerformance == false}"/>
										</p:commandLink>
									</p:column>
									<p:column headerText="A"
										visible="#{kPIPersonAssignBean.list[5]}" width="30">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.paramA}" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.paramA}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="B"
										visible="#{kPIPersonAssignBean.list[6]}"
										disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
										width="30">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.paramB}" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.paramB}" rows="2"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Nguồn dữ liệu chứng minh"
										visible="#{kPIPersonAssignBean.list[11]}" width="100">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.sourceVerify}" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.sourceVerify}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Đơn vị tính"
										visible="#{kPIPersonAssignBean.list[12]}" width="40">

										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.unit}" title="ĐVT" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.unit}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Kế hoạch(KH)" style="text-align:center"
										visible="#{kPIPersonAssignBean.list[13]}" width="49">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.planKPI}" title="ĐVT" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.planKPI}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signKPI}"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Thực hiện(TH)" style="text-align:center"
										visible="#{kPIPersonAssignBean.list[14]}" width="49">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.performKPI}" title="ĐVT" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.performKPI}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
													style="text-align:center">
													<p:ajax event="blur" process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="Tỉ lệ hoàn thành"
										visible="#{kPIPersonAssignBean.list[15]}" width="40"
										style="text-align:center">
										<p:outputLabel value="#{item.ratioComplete/100}" rows="2"
											style="text-align:center">
											<f:convertNumber pattern="##0%" />
										</p:outputLabel>
									</p:column>
									<p:column headerText="Tỉ lệ nhân trọng số "
										visible="#{kPIPersonAssignBean.list[16]}" width="35"
										style="text-align:center">
										<p:outputLabel value="#{item.ratioCompleteIsWeighted/100}"
											rows="2" style="text-align:center">
											<f:convertNumber pattern="##0%" />
										</p:outputLabel>
									</p:column>
									<p:column headerText="Ghi chú"
										visible="#{kPIPersonBean.list[17]}" width="100">
										<p:cellEditor>
											<f:facet name="output">
												<h:outputText value="#{item.note}" title="ĐVT" />
											</f:facet>
											<f:facet name="input">
												<p:inputTextarea value="#{item.note}" rows="2"
													disabled="#{kPIPersonAssignBean.kPIPerson.signResultKPI}"
													style="text-align:center">
													<p:ajax process="@this" />
												</p:inputTextarea>
											</f:facet>
										</p:cellEditor>
									</p:column>
									<p:column headerText="DL chứng minh"
										visible="#{kPIPersonAssignBean.list[18]}" width="45">
										<p:panelGrid id="mainGrid" columns="1" styleClass="noneformat">
											<p:commandLink value="Xem file" process="@this"
												style="font-size: 11px;text-decoration: underline;color: blue;font-style: italic;"
												rendered="#{item.nameAssign!=null}"
												actionListener="#{kPIPersonAssignBean.processDataAssign(item)}" />
										</p:panelGrid>
									</p:column>
								</p:dataTable>
							</p:fieldset>
						</p:fieldset>
						<br />
						<h:outputText value="Chú ý*:" style="font-weight: bold;" />
						<br />
						<h:outputText
							value="- Nhập giá trị các tham số vào các cột (A,B,C,..) theo công thức để tính." />
						<br />
						<h:outputText
							value="- Dữ liệu ngày nhập theo định dạng dd/MM/yyyy (ví dụ: 01/05/2018, 31/12/2018)." />
						<br />
						<h:outputText
							value="- Dữ liệu tỉ lệ % thì nhập phần số bỏ dấu % (ví dụ: 70% nhập 70)." />
						<br />
						<h:outputText
							value="- Ký tự ngăn cách số thập phân là dấu chấm (ví dụ: 9.200)." />
					</h:form>
				</p:tab>
			</p:tabView>
		</h:form>
		<p:dialog widgetVar="dialogCopy" resizable="false"
			closeOnEscape="true" header="Copy sang tháng?">
			<h:form id="dialogCopyid">
				<h:panelGrid columns="4" style="width:100%" cellspacing="4"
					cellpadding="10">
					<p:outputLabel value="Tháng" />
					<p:spinner size="10" value="#{kPIPersonAssignBean.monthCopy}"
						min="1" max="12">
						<p:ajax process="@this" />
					</p:spinner>
					<p:outputLabel value="Năm" />
					<p:spinner size="10" value="#{kPIPersonAssignBean.yearCopy}"
						min="2017" max="2050">
						<p:ajax process="@this" />
					</p:spinner>
				</h:panelGrid>
				<p:separator />
				<div style="width: 100%; text-align: center">
					<p:commandButton value="Chọn" oncomplete="PF('dialogCopy').hide()"
						action="#{kPIPersonAssignBean.createCopy()}"
						update=":menuformid,:messages" />
				</div>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogConfirm" resizable="false" width="400"
			closeOnEscape="true" header="Đã có KPI trong tháng">
			<h:form>
				<h:outputText value="Bạn có muốn thay thế bằng dữ liệu mới không?" />
				<p:separator />
				<p:commandButton value="OK" oncomplete="PF('dialogConfirm').hide()"
					action="#{kPIPersonAssignBean.createAndDelete()}"
					update=":messages,:menuformid:tv:detail" />
				<p:commandButton value="Cancel"
					oncomplete="PF('dialogConfirm').hide()" />
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogConfirmCopy" resizable="false" width="400"
			closeOnEscape="true" header="Đã có KPI trong tháng">
			<h:form>
				<h:outputText value="Bạn có muốn thay thế bằng dữ liệu mới không?" />
				<p:separator />
				<p:commandButton value="OK"
					oncomplete="PF('dialogConfirmCopy').hide()"
					action="#{kPIPersonAssignBean.createAndDeleteCopy()}"
					update=":messages,:menuformid:tv:detail" />
				<p:commandButton value="Cancel"
					oncomplete="PF('dialogConfirmCopy').hide()" />
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogFormula" resizable="false" width="300"
			closeOnEscape="true" header="Công thức tính">
			<h:form id="dialogformula">
				<p:dataTable value="#{kPIPersonAssignBean.formulaKPIs}" lazy="true"
					paginatorPosition="bottom" rowsPerPageTemplate="20,40,60"
					paginator="true" rows="40" rowKey="#{item.id}" scrollable="true"
					scrollHeight="370"
					selection="#{kPIPersonAssignBean.formulaKPISelect}"
					selectionMode="single" id="tableid" resizableColumns="true"
					var="item">
					<p:column headerText="ID" width="20">
						<h:outputText value="#{item.id}" />
					</p:column>
					<p:column headerText="Mô tả công thức">
						<h:outputText value="#{item.code}" />
					</p:column>
					<f:facet name="footer">
						<div style="clear: both;" />
					</f:facet>
				</p:dataTable>
				<p:separator />
				<p:commandButton value="Đặt công thức"
					oncomplete="PF('dialogFormula').hide()"
					action="#{kPIPersonAssignBean.updateFormula()}"
					update=":menuformid:tv:detail:idtableinput" />
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogBeh" resizable="false" width="700"
			closeOnEscape="true" header="Bảng thái độ - hành vi">
			<h:form id="dialogBehid">
				<p:dataTable value="#{kPIPersonAssignBean.behaviourPersons}"
					lazy="true" paginatorPosition="bottom"
					rowsPerPageTemplate="20,40,60" paginator="true" rows="40"
					rowKey="#{item.id}" scrollable="true" style="width:100%"
					id="tablebehid" scrollHeight="370" widgetVar="databehtb"
					resizableColumns="true" var="item">
					<f:facet name="header">
						<div style="float: right">
							<p:commandButton type="submit" value="Đưa vào KPI"
								update=":menuformid:tv:detail:tableidHV"
								action="#{kPIPersonAssignBean.addBehaviour()}"
								icon="ui-icon-arrowreturnthick-1-s" />
						</div>
						<div style="clear: both;" />
					</f:facet>
					<p:column headerText="..." style="width:20px;">
						<p:selectBooleanCheckbox value="#{item.select}"
							rendered="#{!item.header}">
							<p:ajax process="@this" />
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column headerText="STT" style="width:20px">
						<h:outputText value="#{item.code}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Nội dung" style="text-align:left">
						<h:outputText value="#{item.content}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Điểm trừ" width="80"
						style="text-align:center">
						<h:outputText value="#{item.header!=true?item.minusPoint/100:''}">
							<f:convertNumber pattern="##0%" />
						</h:outputText>
					</p:column>
					<f:facet name="footer">
						<div style="clear: both;" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogOrien" resizable="false" width="700"
			closeOnEscape="true" header="Bảng định hướng/mục tiêu">
			<h:form id="dialogOrienid">
				<p:dataTable value="#{kPIPersonAssignBean.orientationPersons}"
					lazy="true" paginatorPosition="bottom"
					rowsPerPageTemplate="20,40,60" paginator="true" rows="40"
					rowKey="#{item.id}" scrollable="true" style="width:100%"
					id="tableorientid" scrollHeight="370" widgetVar="dataorienttb"
					resizableColumns="true" var="item">
					<f:facet name="header">
						<div style="float: right">
							<p:commandButton type="submit" value="Đưa vào KPI"
								update=":menuformid:tv:detail"
								action="#{kPIPersonAssignBean.getOrientationPerson()}"
								icon="ui-icon-arrowreturnthick-1-s" />
						</div>
						<div style="clear: both;" />
					</f:facet>
					<p:column headerText="..." style="width:20px;">
						<p:selectBooleanCheckbox value="#{item.select}"
							rendered="#{!item.header}">
							<p:ajax process="@this" />
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column headerText="STT" style="width:20px">
						<h:outputText value="#{item.code}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Nội dung" style="text-align:left">
						<h:outputText value="#{item.content}"
							styleClass="#{item.header==true?'textboldoutput':''}" />
					</p:column>
					<p:column headerText="Công thức tính" style="text-align:left">
						<h:outputText value="#{item.formulaKPI.code}" />
					</p:column>
					<f:facet name="footer">
						<div style="clear: both;" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="dialogKPIDepart" resizable="false" width="700"
			closeOnEscape="true" header="KPI tháng của phòng">
			<h:form id="dialogKPIDepartid">
				<p:dataTable value="#{kPIPersonAssignBean.kpiDepOfMonths}"
					lazy="true" paginatorPosition="bottom"
					rowsPerPageTemplate="20,40,60" paginator="true" rows="40"
					rowKey="#{item.id}" scrollable="true" style="width:100%"
					scrollHeight="370" widgetVar="datakpideparttb"
					resizableColumns="true" var="item">
					<f:facet name="header">
						<div style="float: right">
							<p:commandButton type="submit" value="Đưa vào KPI"
								update=":menuformid:tv:detail"
								action="#{kPIPersonAssignBean.getKPIDepart()}"
								icon="ui-icon-arrowreturnthick-1-s" />
						</div>
						<div style="clear: both;" />
					</f:facet>
					<p:column headerText="..." style="width:20px;">
						<p:selectBooleanCheckbox value="#{item.select}">
							<p:ajax process="@this" />
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column headerText="Nội dung" style="text-align:left">
						<h:outputText value="#{item.contentAppreciate}" />
					</p:column>
					<p:column headerText="Trọng số" style="text-align:center"
						width="50">
						<h:outputText value="#{item.weighted}%" />
					</p:column>
					<f:facet name="footer">
						<div style="clear: both;" />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>